<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€»è¾‘éªŒè¯æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .test-section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .result { background: #e6f7ff; padding: 10px; margin: 5px 0; border-left: 4px solid #1890ff; }
        .success { background: #f6ffed; border-left-color: #52c41a; }
        .error { background: #fff2f0; border-left-color: #ff4d4f; }
    </style>
</head>
<body>
    <h1>ğŸ”§ DataAnalytics é€»è¾‘éªŒè¯æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>ğŸ“Š æµ‹è¯•æ•°æ®ï¼ˆç”¨æˆ·æä¾›çš„æœ€æ–°æ•°æ®ï¼‰</h3>
        <pre id="testData"></pre>
    </div>
    
    <div class="test-section">
        <h3>ğŸ§ª æµ‹è¯•ç»“æœ</h3>
        <div id="results"></div>
    </div>

    <script>
        // ç”¨æˆ·æä¾›çš„æµ‹è¯•æ•°æ®
        const testData = {
            analytics: {
                total_count: 7,
                university_level_distribution: {
                    "985å·¥ç¨‹": 3,
                    "211å·¥ç¨‹": 2,
                    "æ™®é€šæœ¬ç§‘": 2
                },
                unit_statistics: {
                    available: true,
                    covered_units: 7,
                    total_units: 7,
                    units: [
                        {unit_name: "å¹¿ä¸œ", region: "åå—", recruitment_count: 2, percentage: 28.57},
                        {unit_name: "äº‘å—", region: "è¥¿å—", recruitment_count: 1, percentage: 14.29},
                        {unit_name: "å¹¿è¥¿", region: "åå—", recruitment_count: 1, percentage: 14.29},
                        {unit_name: "è´µå·", region: "è¥¿å—", recruitment_count: 1, percentage: 14.29},
                        {unit_name: "æµ·å—", region: "åå—", recruitment_count: 1, percentage: 14.29},
                        {unit_name: "æ·±åœ³ä¾›ç”µå±€", region: "åå—", recruitment_count: 1, percentage: 14.29},
                        {unit_name: "è¶…é«˜å‹å…¬å¸", region: "åå—", recruitment_count: 1, percentage: 14.29}
                    ]
                },
                school_statistics: {
                    schools: [
                        {school_name: "åå—ç†å·¥å¤§å­¦", school_type: "985å·¥ç¨‹", school_level: "985å·¥ç¨‹", recruitment_count: 2, percentage: 28.57},
                        {school_name: "ä¸­å—å¤§å­¦", school_type: "985å·¥ç¨‹", school_level: "985å·¥ç¨‹", recruitment_count: 1, percentage: 14.29},
                        // ... å…¶ä»–å­¦æ ¡æ•°æ®
                    ]
                },
                gender_distribution: {
                    "ç”·": 5,
                    "å¥³": 2
                }
            }
        };
        
        document.getElementById('testData').textContent = JSON.stringify(testData, null, 2);
        
        // æ¨¡æ‹Ÿ DataAnalytics.vue ä¸­çš„è®¡ç®—é€»è¾‘
        function testSecondaryUnitsCount(data) {
            // ä¼˜å…ˆä½¿ç”¨æ–°çš„unit_statistics.covered_unitså­—æ®µ
            if (data?.analytics?.unit_statistics?.covered_units !== undefined) {
                return data.analytics.unit_statistics.covered_units;
            }
            
            // å¦‚æœæœ‰unit_statistics.unitsæ•°æ®ï¼Œç»Ÿè®¡æœ‰æ•ˆå•ä½æ•°é‡
            if (data?.analytics?.unit_statistics?.units) {
                const units = data.analytics.unit_statistics.units;
                const validUnits = units.filter(unit => (unit.recruitment_count || 0) > 0);
                return validUnits.length;
            }
            
            return 0;
        }
        
        function testRegionChartTitle(data) {
            if (!data?.analytics?.unit_statistics?.units) return 'äºŒçº§å•ä½åˆ†å¸ƒ';
            
            const units = data.analytics.unit_statistics.units;
            const provinceLevelKeywords = ['å±±ä¸œ', 'æ±Ÿè‹', 'æµ™æ±Ÿ', 'æ²³å—', 'å››å·', 'æ¹–åŒ—', 'ç¦å»º', 'å®‰å¾½', 'æ¹–å—', 'é™•è¥¿', 'æ±Ÿè¥¿', 'è¾½å®', 'é»‘é¾™æ±Ÿ', 'æ–°ç–†', 'ç”˜è‚ƒ', 'æ²³åŒ—', 'å±±è¥¿', 'é‡åº†', 'é’æµ·', 'å‰æ—', 'å®å¤', 'ä¸Šæµ·', 'åŒ—äº¬', 'å¤©æ´¥', 'è¥¿è—'];
            
            // æ£€æŸ¥æ˜¯å¦æœ‰æ›´ç»†åˆ†çš„å•ä½
            const hasSubUnits = units.some(unit => {
                const unitName = unit.unit_name || '';
                if (provinceLevelKeywords.includes(unitName)) return false;
                return unitName.includes('ç”µåŠ›ç§‘å­¦ç ”ç©¶é™¢') || unitName.includes('ç»æµæŠ€æœ¯ç ”ç©¶é™¢') || 
                       unitName.includes('åˆ†å…¬å¸') || unitName.includes('åˆ†éƒ¨') ||
                       unitName.includes('äº§ä¸šé›†å›¢') || unitName.includes('å®¢æœä¸­å¿ƒ') ||
                       unitName.includes('ç‰¹é«˜å‹') || unitName.includes('æŠ€æœ¯å­¦é™¢') ||
                       unitName.includes('ä¾›ç”µå±€') || unitName.includes('è¶…é«˜å‹å…¬å¸');
            });
            
            return hasSubUnits ? 'ä¸‹å±å•ä½åˆ†å¸ƒ' : 'äºŒçº§å•ä½åˆ†å¸ƒ';
        }
        
        function testKeySchoolCount(data) {
            const levelDist = data?.analytics?.university_level_distribution || {};
            let keyCount = 0;
            keyCount += levelDist['985å·¥ç¨‹'] || 0;
            keyCount += levelDist['211å·¥ç¨‹'] || 0;
            keyCount += levelDist['åŒä¸€æµ'] || 0;
            return keyCount;
        }
        
        function testGenderRatio(data) {
            const genderDist = data?.analytics?.gender_distribution;
            if (!genderDist) return 'æš‚æ— æ•°æ®';
            
            const male = genderDist['ç”·'] || genderDist.male || 0;
            const female = genderDist['å¥³'] || genderDist.female || 0;
            
            if (male === 0 && female === 0) return 'æš‚æ— æ•°æ®';
            if (female === 0) return 'å…¨ç”·';
            if (male === 0) return 'å…¨å¥³';
            
            const ratio = Math.round(male / female * 10) / 10;
            return `${ratio}:1`;
        }
        
        // è¿è¡Œæµ‹è¯•
        const resultsContainer = document.getElementById('results');
        
        const secondaryUnits = testSecondaryUnitsCount(testData);
        const chartTitle = testRegionChartTitle(testData);
        const keySchools = testKeySchoolCount(testData);
        const genderRatio = testGenderRatio(testData);
        
        const results = [
            {
                test: 'è¦†ç›–äºŒçº§å•ä½æ•°é‡',
                expected: 7,
                actual: secondaryUnits,
                success: secondaryUnits === 7
            },
            {
                test: 'å›¾è¡¨æ ‡é¢˜åˆ¤æ–­',
                expected: 'ä¸‹å±å•ä½åˆ†å¸ƒ',
                actual: chartTitle,
                success: chartTitle === 'ä¸‹å±å•ä½åˆ†å¸ƒ'
            },
            {
                test: 'é‡ç‚¹å­¦æ ¡å½•å–äººæ•°',
                expected: 5,
                actual: keySchools,
                success: keySchools === 5
            },
            {
                test: 'ç”·å¥³æ¯”ä¾‹',
                expected: '2.5:1',
                actual: genderRatio,
                success: genderRatio === '2.5:1'
            }
        ];
        
        results.forEach(result => {
            const div = document.createElement('div');
            div.className = `result ${result.success ? 'success' : 'error'}`;
            div.innerHTML = `
                <strong>${result.test}</strong><br>
                é¢„æœŸ: ${result.expected}<br>
                å®é™…: ${result.actual}<br>
                çŠ¶æ€: ${result.success ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}
            `;
            resultsContainer.appendChild(div);
        });
    </script>
</body>
</html>