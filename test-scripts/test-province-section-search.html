<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çœä»½å’Œä¸“æ æœç´¢åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 20px; }
        .test-container { max-width: 1200px; margin: 0 auto; }
        .test-section { margin-bottom: 30px; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px; }
        .test-title { color: #333; border-bottom: 2px solid #1890ff; padding-bottom: 10px; }
        .test-case { background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 6px; }
        .success { color: #52c41a; }
        .error { color: #ff4d4f; }
        .info { color: #1890ff; }
        .api-endpoint { background: #f0f8ff; padding: 10px; border-radius: 4px; font-family: monospace; }
        .test-result { margin-top: 10px; padding: 10px; border-radius: 4px; }
        .test-result.success { background: #f6ffed; border: 1px solid #b7eb8f; }
        .test-result.error { background: #fff2f0; border: 1px solid #ffccc7; }
        button { background: #1890ff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background: #40a9ff; }
        .loading { color: #1890ff; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ” çœä»½å’Œä¸“æ æœç´¢åŠŸèƒ½æµ‹è¯•</h1>
        <p class="info">æœ¬æµ‹è¯•é¡µé¢ç”¨äºéªŒè¯è‡ªå®šä¹‰å­—æ®µç®¡ç†ç³»ç»Ÿçš„çœä»½å’Œä¸“æ è”åˆæœç´¢åŠŸèƒ½</p>

        <!-- API æ¥å£æµ‹è¯• -->
        <div class="test-section">
            <h2 class="test-title">ğŸ“¡ API æ¥å£æµ‹è¯•</h2>
            
            <div class="test-case">
                <h3>æµ‹è¯• 1: è·å–çœä»½åˆ—è¡¨</h3>
                <div class="api-endpoint">GET /api/v1/custom-fields/provinces</div>
                <p>æœŸæœ›è¿”å›åŒ…å«çœä»½åç§°å’Œå­—æ®µç»Ÿè®¡çš„åˆ—è¡¨</p>
                <button onclick="testGetProvinces()">æµ‹è¯•è·å–çœä»½åˆ—è¡¨</button>
                <div id="provinces-result" class="test-result"></div>
            </div>
            
            <div class="test-case">
                <h3>æµ‹è¯• 2: æŒ‰ä¸“æ ç­›é€‰å­—æ®µ</h3>
                <div class="api-endpoint">GET /api/v1/custom-fields/?section=early_batch</div>
                <p>æœŸæœ›è¿”å›æå‰æ‰¹ä¸“æ çš„æ‰€æœ‰è‡ªå®šä¹‰å­—æ®µ</p>
                <button onclick="testFilterBySection()">æµ‹è¯•ä¸“æ ç­›é€‰</button>
                <div id="section-result" class="test-result"></div>
            </div>
            
            <div class="test-case">
                <h3>æµ‹è¯• 3: æŒ‰çœä»½ç­›é€‰å­—æ®µ</h3>
                <div class="api-endpoint">GET /api/v1/custom-fields/?province=å¹¿ä¸œçœ</div>
                <p>æœŸæœ›è¿”å›å¹¿ä¸œçœç›¸å…³çš„è‡ªå®šä¹‰å­—æ®µ</p>
                <button onclick="testFilterByProvince()">æµ‹è¯•çœä»½ç­›é€‰</button>
                <div id="province-result" class="test-result"></div>
            </div>
            
            <div class="test-case">
                <h3>æµ‹è¯• 4: çœä»½å’Œä¸“æ è”åˆæœç´¢</h3>
                <div class="api-endpoint">GET /api/v1/custom-fields/?section=basic&province=å¹¿ä¸œçœ</div>
                <p>æœŸæœ›è¿”å›å¹¿ä¸œçœåŸºæœ¬æ”¿ç­–ä¿¡æ¯ä¸“æ çš„å­—æ®µ</p>
                <button onclick="testCombinedSearch()">æµ‹è¯•è”åˆæœç´¢</button>
                <div id="combined-result" class="test-result"></div>
            </div>
        </div>

        <!-- å‰ç«¯åŠŸèƒ½æµ‹è¯• -->
        <div class="test-section">
            <h2 class="test-title">ğŸ¨ å‰ç«¯åŠŸèƒ½æµ‹è¯•</h2>
            
            <div class="test-case">
                <h3>æµ‹è¯• 5: æœç´¢ç»„ä»¶äº¤äº’</h3>
                <p>æµ‹è¯•æœç´¢è¿‡æ»¤å™¨çš„äº¤äº’é€»è¾‘å’ŒçŠ¶æ€ç®¡ç†</p>
                <div id="ui-test-area">
                    <div style="margin-bottom: 15px;">
                        <label>é€‰æ‹©ä¸“æ ï¼š</label>
                        <select id="section-select" onchange="updateSearchStatus()">
                            <option value="basic">åŸºæœ¬æ”¿ç­–ä¿¡æ¯</option>
                            <option value="early_batch">æå‰æ‰¹æ¿å—</option>
                            <option value="rural_grid">å†œç½‘æ¿å—</option>
                            <option value="regional">åœ°å¸‚å¿æ¦‚è§ˆ</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label>é€‰æ‹©çœä»½ï¼š</label>
                        <select id="province-select" onchange="updateSearchStatus()">
                            <option value="">è¯·é€‰æ‹©çœä»½</option>
                            <option value="å¹¿ä¸œçœ">å¹¿ä¸œçœ</option>
                            <option value="åŒ—äº¬">åŒ—äº¬</option>
                            <option value="ä¸Šæµ·">ä¸Šæµ·</option>
                            <option value="æµ™æ±Ÿçœ">æµ™æ±Ÿçœ</option>
                        </select>
                    </div>
                    <div id="search-status" style="margin: 10px 0; padding: 10px; background: #f0f8ff; border-radius: 4px;">
                        <strong>å½“å‰æœç´¢çŠ¶æ€ï¼š</strong><span id="status-text">åŸºæœ¬æ”¿ç­–ä¿¡æ¯</span>
                    </div>
                    <button onclick="resetFilters()">é‡ç½®ç­›é€‰</button>
                    <button onclick="simulateSearch()">æ¨¡æ‹Ÿæœç´¢</button>
                </div>
                <div id="ui-result" class="test-result"></div>
            </div>
        </div>

        <!-- æµ‹è¯•ç»“æœæ±‡æ€» -->
        <div class="test-section">
            <h2 class="test-title">ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»</h2>
            <div id="test-summary">
                <p>ç‚¹å‡»ä¸Šæ–¹æµ‹è¯•æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
            </div>
        </div>
    </div>

    <script>
        let testResults = [];

        // æ¨¡æ‹ŸAPIè°ƒç”¨ï¼ˆå®é™…ç¯å¢ƒä¸­ä¼šè°ƒç”¨çœŸå®çš„APIï¼‰
        function mockApiCall(url, expectedData) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    // æ¨¡æ‹Ÿä¸åŒçš„APIå“åº”
                    if (url.includes('provinces')) {
                        resolve({
                            success: true,
                            data: {
                                total_provinces: 2,
                                provinces: [
                                    { province: 'å¹¿ä¸œçœ', field_count: 5 },
                                    { province: 'åŒ—äº¬', field_count: 3 }
                                ]
                            }
                        });
                    } else if (url.includes('section=early_batch')) {
                        resolve({
                            success: true,
                            data: {
                                fields: [
                                    { field_name: 'early_schedule', display_name: 'æå‰æ‰¹æ—¶é—´å®‰æ’', section: 'early_batch' },
                                    { field_name: 'early_requirement', display_name: 'æå‰æ‰¹è¦æ±‚', section: 'early_batch' }
                                ]
                            }
                        });
                    } else if (url.includes('province=å¹¿ä¸œçœ')) {
                        resolve({
                            success: true,
                            data: {
                                fields: [
                                    { field_name: 'gd_special', display_name: 'å¹¿ä¸œç‰¹æ®Šæ”¿ç­–', province: 'å¹¿ä¸œçœ' },
                                    { field_name: 'gd_requirement', display_name: 'å¹¿ä¸œè¦æ±‚', province: 'å¹¿ä¸œçœ' }
                                ]
                            }
                        });
                    } else {
                        resolve({
                            success: true,
                            data: { fields: [] }
                        });
                    }
                }, 500);
            });
        }

        async function testGetProvinces() {
            const resultDiv = document.getElementById('provinces-result');
            resultDiv.innerHTML = '<div class="loading">â³ æ­£åœ¨æµ‹è¯•è·å–çœä»½åˆ—è¡¨...</div>';
            
            try {
                const response = await mockApiCall('/api/v1/custom-fields/provinces');
                if (response.success && response.data.provinces.length > 0) {
                    resultDiv.innerHTML = `
                        <div class="success">âœ… æµ‹è¯•é€šè¿‡</div>
                        <div>å…±è·å–åˆ° ${response.data.total_provinces} ä¸ªçœä»½:</div>
                        <ul>${response.data.provinces.map(p => `<li>${p.province} (${p.field_count}ä¸ªå­—æ®µ)</li>`).join('')}</ul>
                    `;
                    addTestResult('è·å–çœä»½åˆ—è¡¨', true, 'æˆåŠŸè·å–çœä»½æ•°æ®');
                } else {
                    throw new Error('è¿”å›æ•°æ®æ ¼å¼é”™è¯¯');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                addTestResult('è·å–çœä»½åˆ—è¡¨', false, error.message);
            }
        }

        async function testFilterBySection() {
            const resultDiv = document.getElementById('section-result');
            resultDiv.innerHTML = '<div class="loading">â³ æ­£åœ¨æµ‹è¯•ä¸“æ ç­›é€‰...</div>';
            
            try {
                const response = await mockApiCall('/api/v1/custom-fields/?section=early_batch');
                if (response.success && response.data.fields.length > 0) {
                    resultDiv.innerHTML = `
                        <div class="success">âœ… æµ‹è¯•é€šè¿‡</div>
                        <div>æ‰¾åˆ° ${response.data.fields.length} ä¸ªæå‰æ‰¹å­—æ®µ:</div>
                        <ul>${response.data.fields.map(f => `<li>${f.display_name} (${f.field_name})</li>`).join('')}</ul>
                    `;
                    addTestResult('ä¸“æ ç­›é€‰', true, `æ‰¾åˆ°${response.data.fields.length}ä¸ªå­—æ®µ`);
                } else {
                    throw new Error('æœªæ‰¾åˆ°æå‰æ‰¹å­—æ®µ');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                addTestResult('ä¸“æ ç­›é€‰', false, error.message);
            }
        }

        async function testFilterByProvince() {
            const resultDiv = document.getElementById('province-result');
            resultDiv.innerHTML = '<div class="loading">â³ æ­£åœ¨æµ‹è¯•çœä»½ç­›é€‰...</div>';
            
            try {
                const response = await mockApiCall('/api/v1/custom-fields/?province=å¹¿ä¸œçœ');
                if (response.success && response.data.fields.length > 0) {
                    resultDiv.innerHTML = `
                        <div class="success">âœ… æµ‹è¯•é€šè¿‡</div>
                        <div>æ‰¾åˆ° ${response.data.fields.length} ä¸ªå¹¿ä¸œçœå­—æ®µ:</div>
                        <ul>${response.data.fields.map(f => `<li>${f.display_name} (${f.field_name})</li>`).join('')}</ul>
                    `;
                    addTestResult('çœä»½ç­›é€‰', true, `æ‰¾åˆ°${response.data.fields.length}ä¸ªå­—æ®µ`);
                } else {
                    throw new Error('æœªæ‰¾åˆ°å¹¿ä¸œçœå­—æ®µ');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                addTestResult('çœä»½ç­›é€‰', false, error.message);
            }
        }

        async function testCombinedSearch() {
            const resultDiv = document.getElementById('combined-result');
            resultDiv.innerHTML = '<div class="loading">â³ æ­£åœ¨æµ‹è¯•è”åˆæœç´¢...</div>';
            
            try {
                const response = await mockApiCall('/api/v1/custom-fields/?section=basic&province=å¹¿ä¸œçœ');
                resultDiv.innerHTML = `
                    <div class="success">âœ… æµ‹è¯•é€šè¿‡</div>
                    <div>è”åˆæœç´¢å‚æ•°: section=basic, province=å¹¿ä¸œçœ</div>
                    <div>æ‰¾åˆ° ${response.data.fields.length} ä¸ªåŒ¹é…å­—æ®µ</div>
                `;
                addTestResult('è”åˆæœç´¢', true, 'è”åˆæœç´¢åŠŸèƒ½æ­£å¸¸');
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                addTestResult('è”åˆæœç´¢', false, error.message);
            }
        }

        function updateSearchStatus() {
            const section = document.getElementById('section-select').value;
            const province = document.getElementById('province-select').value;
            
            const sectionNames = {
                'basic': 'åŸºæœ¬æ”¿ç­–ä¿¡æ¯',
                'early_batch': 'æå‰æ‰¹æ¿å—',
                'rural_grid': 'å†œç½‘æ¿å—',
                'regional': 'åœ°å¸‚å¿æ¦‚è§ˆ'
            };
            
            let statusText = sectionNames[section] || section;
            if (province) {
                statusText += ` | çœä»½ï¼š${province}`;
            }
            
            document.getElementById('status-text').textContent = statusText;
        }

        function resetFilters() {
            document.getElementById('section-select').value = 'basic';
            document.getElementById('province-select').value = '';
            updateSearchStatus();
            
            const resultDiv = document.getElementById('ui-result');
            resultDiv.innerHTML = '<div class="success">âœ… ç­›é€‰å™¨å·²é‡ç½®</div>';
            addTestResult('é‡ç½®ç­›é€‰å™¨', true, 'ç­›é€‰å™¨é‡ç½®åŠŸèƒ½æ­£å¸¸');
        }

        function simulateSearch() {
            const section = document.getElementById('section-select').value;
            const province = document.getElementById('province-select').value;
            
            const resultDiv = document.getElementById('ui-result');
            resultDiv.innerHTML = `
                <div class="success">âœ… æ¨¡æ‹Ÿæœç´¢æ‰§è¡ŒæˆåŠŸ</div>
                <div>æœç´¢å‚æ•°: section=${section}, province=${province || '(ç©º)'}</div>
            `;
            addTestResult('å‰ç«¯äº¤äº’', true, 'æœç´¢ç»„ä»¶äº¤äº’æ­£å¸¸');
        }

        function addTestResult(testName, passed, message) {
            testResults.push({ testName, passed, message, timestamp: new Date() });
            updateTestSummary();
        }

        function updateTestSummary() {
            const summaryDiv = document.getElementById('test-summary');
            const passedTests = testResults.filter(t => t.passed).length;
            const totalTests = testResults.length;
            
            let html = `
                <h3>æµ‹è¯•ç»Ÿè®¡ (${passedTests}/${totalTests} é€šè¿‡)</h3>
                <div style="margin: 10px 0;">
                    <div style="width: 100%; background: #f0f0f0; border-radius: 4px; height: 20px;">
                        <div style="width: ${(passedTests/totalTests)*100}%; background: #52c41a; height: 100%; border-radius: 4px; transition: width 0.3s;"></div>
                    </div>
                </div>
                <ul>
            `;
            
            testResults.forEach(result => {
                const icon = result.passed ? 'âœ…' : 'âŒ';
                const color = result.passed ? '#52c41a' : '#ff4d4f';
                html += `<li style="color: ${color};">${icon} ${result.testName}: ${result.message}</li>`;
            });
            
            html += '</ul>';
            
            if (totalTests > 0) {
                const overallStatus = passedTests === totalTests ? 'ğŸ‰ å…¨éƒ¨æµ‹è¯•é€šè¿‡ï¼' : 'âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥';
                html += `<div style="margin-top: 15px; padding: 10px; background: ${passedTests === totalTests ? '#f6ffed' : '#fff7e6'}; border-radius: 4px;">
                    <strong>${overallStatus}</strong>
                </div>`;
            }
            
            summaryDiv.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºæœ¬æµ‹è¯•
        window.onload = function() {
            setTimeout(() => {
                console.log('ğŸš€ å¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
                updateSearchStatus();
            }, 1000);
        };
    </script>
</body>
</html>