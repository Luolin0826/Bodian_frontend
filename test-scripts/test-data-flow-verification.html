<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®æµéªŒè¯æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .section { background: #f5f5f5; padding: 15px; margin: 15px 0; border-radius: 8px; }
        .data-box { background: #e6f7ff; padding: 10px; margin: 10px 0; border-left: 4px solid #1890ff; font-family: monospace; }
        .result { background: #f6ffed; padding: 10px; margin: 10px 0; border-left: 4px solid #52c41a; }
        .step { margin: 10px 0; padding: 8px; background: white; border-radius: 4px; }
        .step-title { font-weight: bold; color: #1890ff; }
    </style>
</head>
<body>
    <h1>ğŸ”„ æ•°æ®æµéªŒè¯æµ‹è¯•</h1>
    
    <div class="section">
        <h3>ğŸ“¡ 1. åç«¯åŸå§‹å“åº”æ•°æ®</h3>
        <div class="step">
            <div class="step-title">æ¥è‡ª /api/v1/data-search/search çš„å“åº”ï¼š</div>
            <div class="data-box" id="backendResponse"></div>
        </div>
    </div>
    
    <div class="section">
        <h3>ğŸ”§ 2. APIé€‚é…å±‚å¤„ç†</h3>
        <div class="step">
            <div class="step-title">recruitment.ts ä¸­çš„æ•°æ®é€‚é…ï¼š</div>
            <div class="data-box" id="adaptedData"></div>
        </div>
    </div>
    
    <div class="section">
        <h3>ğŸ¯ 3. å‰ç«¯ç»„ä»¶æ•°æ®è®¿é—®</h3>
        <div class="step">
            <div class="step-title">DataAnalytics.vue ä¸­çš„æ•°æ®è¯»å–ï¼š</div>
            <div class="data-box" id="frontendAccess"></div>
        </div>
    </div>
    
    <div class="section">
        <h3>âœ… 4. éªŒè¯ç»“æœ</h3>
        <div id="validationResults"></div>
    </div>

    <script>
        // 1. æ¨¡æ‹Ÿåç«¯åŸå§‹å“åº”ï¼ˆåŸºäºå®é™…æµ‹è¯•ç»“æœï¼‰
        const backendOriginalResponse = {
            "total_records": 5095,
            "unit_statistics": {
                "available": true,
                "covered_units": 7,
                "total_units": 7,
                "units": [
                    {"unit_name": "å¹¿ä¸œ", "region": "å—æ–¹", "recruitment_count": 1750, "percentage": 34.35},
                    {"unit_name": "äº‘å—", "region": "è¥¿å—", "recruitment_count": 1204, "percentage": 23.63},
                    {"unit_name": "å¹¿è¥¿", "region": "å—æ–¹", "recruitment_count": 895, "percentage": 17.57},
                    {"unit_name": "è´µå·", "region": "è¥¿å—", "recruitment_count": 652, "percentage": 12.80},
                    {"unit_name": "æµ·å—", "region": "å—æ–¹", "recruitment_count": 427, "percentage": 8.38},
                    {"unit_name": "æ·±åœ³ä¾›ç”µå±€", "region": "å—æ–¹", "recruitment_count": 134, "percentage": 2.63},
                    {"unit_name": "è¶…é«˜å‹å…¬å¸", "region": "å—æ–¹", "recruitment_count": 33, "percentage": 0.65}
                ]
            },
            "school_statistics": {
                "schools": [
                    {"school_name": "åå—ç†å·¥å¤§å­¦", "school_type": "985å·¥ç¨‹", "school_level": "985å·¥ç¨‹", "recruitment_count": 234, "percentage": 4.59},
                    {"school_name": "ä¸­å—å¤§å­¦", "school_type": "985å·¥ç¨‹", "school_level": "985å·¥ç¨‹", "recruitment_count": 187, "percentage": 3.67}
                ]
            },
            "statistics": {
                "university_level_distribution": {
                    "985å·¥ç¨‹": 1256,
                    "211å·¥ç¨‹": 2089,
                    "æ™®é€šæœ¬ç§‘": 1750
                },
                "gender_distribution": {
                    "ç”·": 4076,
                    "å¥³": 1019
                }
            }
        };
        
        // 2. æ¨¡æ‹ŸAPIé€‚é…å±‚å¤„ç†ï¼ˆrecruitment.tsä¸­çš„é€»è¾‘ï¼‰
        function simulateApiAdapter(backendResponse) {
            return {
                query_params: {"company": "å—ç½‘", "batch": "ä¸€æ‰¹"},
                policies: [],
                summary: {
                    total_records: backendResponse.total_records || 0,
                    by_level: backendResponse.statistics?.university_level_distribution || {},
                    by_region_type: {}
                },
                data_analysis: {
                    total_count: backendResponse.total_records,
                    total_records: backendResponse.total_records,
                    gender_distribution: backendResponse.statistics?.gender_distribution || {},
                    school_type_distribution: backendResponse.statistics?.university_level_distribution || {},
                    university_level_distribution: backendResponse.statistics?.university_level_distribution || {},
                    school_statistics: backendResponse.school_statistics || {},
                    // å…³é”®ï¼šunit_statistics æ•°æ®æ˜ å°„
                    unit_statistics: backendResponse.unit_statistics || {
                        available: false,
                        covered_units: 0,
                        total_units: 0,
                        units: []
                    }
                }
            };
        }
        
        // 3. æ¨¡æ‹Ÿå‰ç«¯ç»„ä»¶æ•°æ®è®¿é—®
        function simulateFrontendAccess(adaptedData) {
            const propsData = { analytics: adaptedData.data_analysis };
            
            // æ¨¡æ‹Ÿ secondaryUnitsCount è®¡ç®—
            function getSecondaryUnitsCount() {
                if (propsData?.analytics?.unit_statistics?.covered_units !== undefined) {
                    return propsData.analytics.unit_statistics.covered_units;
                }
                if (propsData?.analytics?.unit_statistics?.units) {
                    const units = propsData.analytics.unit_statistics.units;
                    const validUnits = units.filter(unit => (unit.recruitment_count || 0) > 0);
                    return validUnits.length;
                }
                return 0;
            }
            
            // æ¨¡æ‹Ÿ regionChartTitle è®¡ç®—
            function getRegionChartTitle() {
                if (!propsData?.analytics?.unit_statistics?.units) return 'äºŒçº§å•ä½åˆ†å¸ƒ';
                
                const units = propsData.analytics.unit_statistics.units;
                const provinceLevelKeywords = ['å±±ä¸œ', 'æ±Ÿè‹', 'æµ™æ±Ÿ', 'æ²³å—', 'å››å·', 'æ¹–åŒ—', 'ç¦å»º', 'å®‰å¾½', 'æ¹–å—', 'é™•è¥¿', 'æ±Ÿè¥¿', 'è¾½å®', 'é»‘é¾™æ±Ÿ', 'æ–°ç–†', 'ç”˜è‚ƒ', 'æ²³åŒ—', 'å±±è¥¿', 'é‡åº†', 'é’æµ·', 'å‰æ—', 'å®å¤', 'ä¸Šæµ·', 'åŒ—äº¬', 'å¤©æ´¥', 'è¥¿è—', 'å¹¿ä¸œ', 'äº‘å—', 'å¹¿è¥¿', 'è´µå·', 'æµ·å—'];
                
                const hasSubUnits = units.some(unit => {
                    const unitName = unit.unit_name || '';
                    if (provinceLevelKeywords.includes(unitName)) return false;
                    return unitName.includes('ä¾›ç”µå±€') || unitName.includes('è¶…é«˜å‹å…¬å¸') || 
                           unitName.includes('ç”µåŠ›ç§‘å­¦ç ”ç©¶é™¢') || unitName.includes('åˆ†å…¬å¸') ||
                           unitName.includes('åˆ†éƒ¨') || unitName.includes('äº§ä¸šé›†å›¢');
                });
                
                return hasSubUnits ? 'ä¸‹å±å•ä½åˆ†å¸ƒ' : 'äºŒçº§å•ä½åˆ†å¸ƒ';
            }
            
            return {
                secondaryUnitsCount: getSecondaryUnitsCount(),
                regionChartTitle: getRegionChartTitle(),
                totalCount: propsData?.analytics?.total_count || 0,
                unitsData: propsData?.analytics?.unit_statistics?.units || []
            };
        }
        
        // æ‰§è¡ŒéªŒè¯
        const adaptedData = simulateApiAdapter(backendOriginalResponse);
        const frontendResult = simulateFrontendAccess(adaptedData);
        
        // æ˜¾ç¤ºæ•°æ®
        document.getElementById('backendResponse').textContent = JSON.stringify(backendOriginalResponse, null, 2);
        document.getElementById('adaptedData').textContent = JSON.stringify(adaptedData.data_analysis, null, 2);
        document.getElementById('frontendAccess').textContent = JSON.stringify(frontendResult, null, 2);
        
        // éªŒè¯ç»“æœ
        const validationResults = document.getElementById('validationResults');
        
        const tests = [
            {
                name: 'æ€»å½•å–äººæ•°',
                expected: 5095,
                actual: frontendResult.totalCount,
                success: frontendResult.totalCount === 5095
            },
            {
                name: 'è¦†ç›–äºŒçº§å•ä½æ•°é‡',
                expected: 7,
                actual: frontendResult.secondaryUnitsCount,
                success: frontendResult.secondaryUnitsCount === 7
            },
            {
                name: 'å›¾è¡¨æ ‡é¢˜',
                expected: 'ä¸‹å±å•ä½åˆ†å¸ƒ',
                actual: frontendResult.regionChartTitle,
                success: frontendResult.regionChartTitle === 'ä¸‹å±å•ä½åˆ†å¸ƒ'
            },
            {
                name: 'å•ä½æ•°æ®å®Œæ•´æ€§',
                expected: 7,
                actual: frontendResult.unitsData.length,
                success: frontendResult.unitsData.length === 7
            },
            {
                name: 'å¹¿ä¸œå•ä½æ•°æ®',
                expected: 1750,
                actual: frontendResult.unitsData.find(unit => unit.unit_name === 'å¹¿ä¸œ')?.recruitment_count,
                success: frontendResult.unitsData.find(unit => unit.unit_name === 'å¹¿ä¸œ')?.recruitment_count === 1750
            }
        ];
        
        tests.forEach(test => {
            const div = document.createElement('div');
            div.className = test.success ? 'result' : 'step';
            div.style.borderLeftColor = test.success ? '#52c41a' : '#ff4d4f';
            div.style.background = test.success ? '#f6ffed' : '#fff2f0';
            div.innerHTML = `
                <strong>${test.name}</strong><br>
                é¢„æœŸ: ${test.expected}<br>
                å®é™…: ${test.actual}<br>
                çŠ¶æ€: ${test.success ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}
            `;
            validationResults.appendChild(div);
        });
    </script>
</body>
</html>