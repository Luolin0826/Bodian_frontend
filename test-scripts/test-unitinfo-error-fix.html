<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UnitInfoå¼•ç”¨é”™è¯¯ä¿®å¤éªŒè¯</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 20px; }
        .test-container { max-width: 1000px; margin: 0 auto; }
        .error-section { background: #fff2f0; border: 1px solid #ffccc7; border-radius: 8px; padding: 20px; margin: 20px 0; }
        .fix-section { background: #f6ffed; border: 1px solid #b7eb8f; border-radius: 8px; padding: 20px; margin: 20px 0; }
        .code-block { background: #f6f8fa; padding: 12px; border-radius: 4px; font-family: monospace; margin: 8px 0; font-size: 13px; }
        .error-code { background: #fff2f0; border-left: 4px solid #ff4d4f; }
        .fix-code { background: #f6ffed; border-left: 4px solid #52c41a; }
        .success { color: #52c41a; font-weight: bold; }
        .error { color: #ff4d4f; font-weight: bold; }
        .warning { color: #faad14; font-weight: bold; }
        .info { color: #1890ff; }
        h1, h2, h3 { color: #333; }
        .test-case { margin: 15px 0; padding: 15px; background: #fafafa; border-radius: 6px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ UnitInfoå¼•ç”¨é”™è¯¯ä¿®å¤éªŒè¯</h1>
        <p class="info">ä¿®å¤ç‚¹å‡»"ç®¡ç†å­—æ®µ"æ—¶å‡ºç°çš„"unitInfo is not defined"é”™è¯¯</p>

        <!-- é”™è¯¯è¯¦æƒ… -->
        <div class="error-section">
            <h2 class="error">âŒ åŸé”™è¯¯ä¿¡æ¯</h2>
            <div class="code-block error-code">
main.ts:25 Global Error: ReferenceError: unitInfo is not defined
    at openFieldManagerDialog (UnitPolicyDisplay.vue:653:17)
    component event handler
            </div>
            <p><strong>é”™è¯¯åŸå› :</strong> åœ¨Vue 3ç»„åˆå¼APIä¸­ï¼Œpropsä¸ä¼šè‡ªåŠ¨åˆ›å»ºå“åº”å¼å¼•ç”¨ï¼Œéœ€è¦é€šè¿‡propså¯¹è±¡è®¿é—®</p>
        </div>

        <!-- ä¿®å¤æ–¹æ¡ˆ -->
        <div class="fix-section">
            <h2 class="success">âœ… ä¿®å¤æ–¹æ¡ˆ</h2>
            
            <div class="test-case">
                <h3>é—®é¢˜1: currentProvinceè®¡ç®—å±æ€§ä¸­çš„é”™è¯¯å¼•ç”¨</h3>
                
                <p><strong class="error">ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰:</strong></p>
                <div class="code-block error-code">
const currentProvince = computed(() => {
  if (!unitInfo.value?.unit_name) return ''  // âŒ unitInfoä¸å­˜åœ¨
  const unitName = unitInfo.value.unit_name  // âŒ unitInfoä¸å­˜åœ¨
  // ...
})
                </div>
                
                <p><strong class="success">ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰:</strong></p>
                <div class="code-block fix-code">
const currentProvince = computed(() => {
  if (!props.unitInfo?.unit_name) return ''  // âœ… ä½¿ç”¨props.unitInfo
  const unitName = props.unitInfo.unit_name  // âœ… ä½¿ç”¨props.unitInfo
  // ...
})
                </div>
            </div>
            
            <div class="test-case">
                <h3>é—®é¢˜2: è°ƒè¯•æ—¥å¿—ä¸­çš„é”™è¯¯å¼•ç”¨</h3>
                
                <p><strong class="error">ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰:</strong></p>
                <div class="code-block error-code">
const openFieldManagerDialog = () => {
  console.log('ğŸ”§ æ‰“å¼€å­—æ®µç®¡ç†å¯¹è¯æ¡†:', {
    'unitInfo': unitInfo.value,        // âŒ unitInfoä¸å­˜åœ¨
    'unitName': unitInfo.value?.unit_name,  // âŒ unitInfoä¸å­˜åœ¨
    // ...
  })
}
                </div>
                
                <p><strong class="success">ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰:</strong></p>
                <div class="code-block fix-code">
const openFieldManagerDialog = () => {
  console.log('ğŸ”§ æ‰“å¼€å­—æ®µç®¡ç†å¯¹è¯æ¡†:', {
    'unitInfo': props.unitInfo,        // âœ… ä½¿ç”¨props.unitInfo
    'unitName': props.unitInfo?.unit_name,  // âœ… ä½¿ç”¨props.unitInfo
    // ...
  })
}
                </div>
            </div>
        </div>

        <!-- æ¶‰åŠçš„ç»„ä»¶ -->
        <div class="test-case">
            <h2 class="info">ğŸ“ ä¿®å¤çš„ç»„ä»¶æ–‡ä»¶</h2>
            <ul>
                <li><strong>UnitPolicyDisplay.vue</strong>: ä¿®å¤currentProvinceå’ŒopenFieldManagerDialogä¸­çš„å¼•ç”¨</li>
                <li><strong>EarlyBatchInfo.vue</strong>: ä¿®å¤currentProvinceä¸­çš„å¼•ç”¨</li>
                <li><strong>RuralGridInfo.vue</strong>: ä¿®å¤currentProvinceä¸­çš„å¼•ç”¨</li>
            </ul>
            
            <h3>Vue 3 ç»„åˆå¼APIçš„æ­£ç¡®ä½¿ç”¨</h3>
            <div class="code-block">
// âœ… æ­£ç¡®ï¼šåœ¨ç»„åˆå¼APIä¸­è®¿é—®props
const props = defineProps&lt;{
  unitInfo?: UnitInfo | null
}&gt;()

// åœ¨è®¡ç®—å±æ€§æˆ–å‡½æ•°ä¸­ä½¿ç”¨
const someComputed = computed(() => {
  return props.unitInfo?.unit_name  // âœ… æ­£ç¡®
})

// âŒ é”™è¯¯ï¼šè¯•å›¾ç›´æ¥ä½¿ç”¨unitInfo
const wrongComputed = computed(() => {
  return unitInfo.value?.unit_name  // âŒ unitInfoæœªå®šä¹‰
})
            </div>
        </div>

        <!-- éªŒè¯æ­¥éª¤ -->
        <div class="test-case">
            <h2 class="success">ğŸ§ª éªŒè¯æ­¥éª¤</h2>
            <ol>
                <li>é€‰æ‹©ä¸€ä¸ªç”µåŠ›å…¬å¸å•ä½ï¼ˆå¦‚å››å·çœç”µåŠ›å…¬å¸ï¼‰</li>
                <li>ç‚¹å‡»"ç®¡ç†å­—æ®µ (æ·»åŠ /ç¼–è¾‘/åˆ é™¤/æ’åº)"æŒ‰é’®</li>
                <li>ç¡®è®¤ä¸å†å‡ºç°"unitInfo is not defined"é”™è¯¯</li>
                <li>æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤è°ƒè¯•ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º</li>
                <li>éªŒè¯å­—æ®µç®¡ç†å¯¹è¯æ¡†æ­£å¸¸æ‰“å¼€</li>
                <li>ç¡®è®¤provinceå‚æ•°æ­£ç¡®ä¼ é€’</li>
            </ol>
            
            <h3 class="success">é¢„æœŸç»“æœ:</h3>
            <ul>
                <li>âœ… ç‚¹å‡»"ç®¡ç†å­—æ®µ"æŒ‰é’®ä¸ä¼šæŠ¥é”™</li>
                <li>âœ… æ§åˆ¶å°æ˜¾ç¤ºæ­£ç¡®çš„è°ƒè¯•ä¿¡æ¯</li>
                <li>âœ… å­—æ®µç®¡ç†å¯¹è¯æ¡†æ­£å¸¸æ‰“å¼€</li>
                <li>âœ… APIè°ƒç”¨åŒ…å«æ­£ç¡®çš„provinceå‚æ•°</li>
            </ul>
        </div>

        <!-- æ„å»ºéªŒè¯ -->
        <div class="fix-section">
            <h2 class="success">âœ… æ„å»ºéªŒè¯</h2>
            <div class="code-block">
> npm run build
> vite build --mode production

vite v7.1.2 building for production...
âœ“ 4006 modules transformed.
            </div>
            <p class="success">âœ… æ„å»ºæˆåŠŸï¼Œæ— TypeScriptç±»å‹é”™è¯¯</p>
        </div>

        <!-- ä¿®å¤æ€»ç»“ -->
        <div class="test-case">
            <h2 class="info">ğŸ“‹ ä¿®å¤æ€»ç»“</h2>
            <p>è¿™ä¸ªé”™è¯¯æ˜¯ç”±äºåœ¨Vue 3ç»„åˆå¼APIä¸­é”™è¯¯åœ°å¼•ç”¨propså¯¼è‡´çš„ã€‚ä¸»è¦é—®é¢˜åŒ…æ‹¬ï¼š</p>
            <ul>
                <li><strong>é”™è¯¯ç†è§£:</strong> ä»¥ä¸ºpropsä¼šè‡ªåŠ¨åˆ›å»ºrefå“åº”å¼å¯¹è±¡</li>
                <li><strong>æ­£ç¡®åšæ³•:</strong> åœ¨ç»„åˆå¼APIä¸­å¿…é¡»é€šè¿‡propså¯¹è±¡è®¿é—®å±æ€§</li>
                <li><strong>å½±å“èŒƒå›´:</strong> 3ä¸ªç»„ä»¶çš„currentProvinceè®¡ç®—å±æ€§å’Œè°ƒè¯•æ—¥å¿—</li>
                <li><strong>ä¿®å¤æ–¹å¼:</strong> å°†<code>unitInfo.value</code>æ”¹ä¸º<code>props.unitInfo</code></li>
            </ul>
            
            <p class="success"><strong>ä¿®å¤å®Œæˆï¼</strong> ç°åœ¨å¯ä»¥æ­£å¸¸ç‚¹å‡»"ç®¡ç†å­—æ®µ"æŒ‰é’®è€Œä¸ä¼šå‡ºç°JavaScripté”™è¯¯ã€‚</p>
        </div>
    </div>

    <script>
        console.log('ğŸ”§ UnitInfoå¼•ç”¨é”™è¯¯ä¿®å¤éªŒè¯');
        console.log('ä¿®å¤çš„é—®é¢˜:', {
            'é”™è¯¯ç±»å‹': 'ReferenceError: unitInfo is not defined',
            'é”™è¯¯ä½ç½®': 'openFieldManagerDialogå‡½æ•°',
            'é”™è¯¯åŸå› ': 'Vue3ç»„åˆå¼APIä¸­é”™è¯¯è®¿é—®props',
            'ä¿®å¤æ–¹æ³•': 'ä½¿ç”¨props.unitInfoæ›¿ä»£unitInfo.value'
        });
        console.log('âœ… ä¿®å¤å·²å®Œæˆï¼Œæ„å»ºæµ‹è¯•é€šè¿‡');
    </script>
</body>
</html>