<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çœä»½ç­›é€‰ä¿®å¤éªŒè¯æµ‹è¯•</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 20px; }
        .test-container { max-width: 1200px; margin: 0 auto; }
        .test-section { margin-bottom: 30px; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px; }
        .test-title { color: #333; border-bottom: 2px solid #1890ff; padding-bottom: 10px; }
        .test-case { background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 6px; }
        .success { color: #52c41a; font-weight: bold; }
        .error { color: #ff4d4f; font-weight: bold; }
        .warning { color: #faad14; font-weight: bold; }
        .info { color: #1890ff; }
        .before-after { display: flex; gap: 20px; margin: 15px 0; }
        .before, .after { flex: 1; padding: 15px; border-radius: 6px; }
        .before { background: #fff2f0; border-left: 4px solid #ff4d4f; }
        .after { background: #f6ffed; border-left: 4px solid #52c41a; }
        .code-block { background: #f6f8fa; padding: 12px; border-radius: 4px; font-family: monospace; margin: 8px 0; font-size: 13px; }
        .api-call { background: #e6f7ff; padding: 8px 12px; border-radius: 4px; font-family: monospace; margin: 5px 0; }
        button { background: #1890ff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #40a9ff; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-success { background: #52c41a; }
        .status-error { background: #ff4d4f; }
        .highlight { background: #fffbe6; padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ çœä»½ç­›é€‰ä¿®å¤éªŒè¯æµ‹è¯•</h1>
        <p class="info">éªŒè¯å­—æ®µåŠ è½½å’Œå­—æ®µç®¡ç†åŠŸèƒ½çš„çœä»½ç­›é€‰æ˜¯å¦æ­£ç¡®å·¥ä½œ</p>

        <!-- é—®é¢˜æ€»ç»“ -->
        <div class="test-section">
            <h2 class="test-title">âŒ ä¿®å¤çš„é—®é¢˜</h2>
            
            <div class="test-case">
                <h3>é—®é¢˜1: å­—æ®µå€¼åŠ è½½æ²¡æœ‰çœä»½ç­›é€‰</h3>
                <div class="code-block error">
                    âŒ ä¿®å¤å‰APIè°ƒç”¨:
                    GET /api/v1/custom-fields/values/5?section=basic
                    
                    ç»“æœ: è¿”å›æ‰€æœ‰çœä»½çš„å­—æ®µï¼ˆåŒ…æ‹¬å¹¿ä¸œçœçš„å­—æ®µï¼‰
                </div>
                
                <h3>é—®é¢˜2: å­—æ®µç®¡ç†æ²¡æœ‰çœä»½å‚æ•°</h3>
                <div class="code-block error">
                    âŒ ä¿®å¤å‰APIè°ƒç”¨:
                    GET /api/v1/custom-fields/manage/basic
                    
                    ç»“æœ: è¿”å›æ‰€æœ‰å­—æ®µï¼Œæ— æ³•æŒ‰çœä»½ç­›é€‰
                </div>
            </div>
        </div>

        <!-- ä¿®å¤æ–¹æ¡ˆ -->
        <div class="test-section">
            <h2 class="test-title">âœ… ä¿®å¤æ–¹æ¡ˆ</h2>
            
            <div class="test-case">
                <h3>ä¿®å¤1: å¢åŠ çœä»½å‚æ•°åˆ°å­—æ®µå€¼API</h3>
                <div class="code-block success">
                    // APIå‡½æ•°ç­¾åæ›´æ–°
                    getCustomFieldValues(unitId: number, section?: string, province?: string)
                    
                    // è°ƒç”¨æ—¶ä¼ é€’çœä»½å‚æ•°
                    const values = await customFieldsAPI.getCustomFieldValues(unitId, 'basic', currentProvince.value)
                </div>
                
                <h3>ä¿®å¤2: ä¿®å¤æ­£åˆ™è¡¨è¾¾å¼è¯†åˆ«çœä»½</h3>
                <div class="code-block success">
                    // ä¿®å¤å‰ï¼šåªåŒ¹é…è‹±æ–‡å­—ç¬¦
                    const match = unitName.match(/(\w+)çœ/)
                    
                    // ä¿®å¤åï¼šåŒ¹é…ä¸­æ–‡å­—ç¬¦
                    const match = unitName.match(/([\u4e00-\u9fa5]+)çœ/)
                </div>
                
                <h3>ä¿®å¤3: æ·»åŠ è°ƒè¯•ä¿¡æ¯</h3>
                <div class="code-block info">
                    // åœ¨ç»„ä»¶ä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—
                    console.log('ğŸ”§ æ‰“å¼€å­—æ®µç®¡ç†å¯¹è¯æ¡†:', {
                        'unitInfo': unitInfo.value,
                        'unitName': unitInfo.value?.unit_name,
                        'currentProvince': currentProvince.value
                    })
                </div>
            </div>
        </div>

        <!-- é¢„æœŸAPIè°ƒç”¨å¯¹æ¯” -->
        <div class="test-section">
            <h2 class="test-title">ğŸ†š APIè°ƒç”¨å¯¹æ¯”</h2>
            
            <div class="test-case">
                <h3>å››å·çœç”µåŠ›å…¬å¸ - å­—æ®µåŠ è½½</h3>
                <div class="before-after">
                    <div class="before">
                        <h4><span class="status-indicator status-error"></span>ä¿®å¤å‰</h4>
                        <div class="api-call">GET /api/v1/custom-fields/values/5?section=basic</div>
                        <p><strong>è¿”å›ç»“æœ:</strong> æ‰€æœ‰çœä»½çš„basicå­—æ®µ</p>
                        <div class="code-block">
{
  "field_values": {
    "basic": [
      { "field_name": "custom_1757226925033", "province": "å¹¿ä¸œçœ" },
      { "field_name": "special_requirement", "province": "å¹¿ä¸œçœ" },
      { "field_name": "sichuan_policy", "province": "å››å·çœ" }
    ]
  }
}
                        </div>
                    </div>
                    
                    <div class="after">
                        <h4><span class="status-indicator status-success"></span>ä¿®å¤å</h4>
                        <div class="api-call">GET /api/v1/custom-fields/values/5?section=basic&province=å››å·çœ</div>
                        <p><strong>è¿”å›ç»“æœ:</strong> åªæœ‰å››å·çœçš„basicå­—æ®µ</p>
                        <div class="code-block">
{
  "field_values": {
    "basic": [
      { "field_name": "sichuan_policy", "province": "å››å·çœ" },
      { "field_name": "local_requirement", "province": "å››å·çœ" }
    ]
  }
}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="test-case">
                <h3>å››å·çœç”µåŠ›å…¬å¸ - å­—æ®µç®¡ç†</h3>
                <div class="before-after">
                    <div class="before">
                        <h4><span class="status-indicator status-error"></span>ä¿®å¤å‰</h4>
                        <div class="api-call">GET /api/v1/custom-fields/manage/basic</div>
                        <p><strong>è¿”å›ç»“æœ:</strong> æ‰€æœ‰å­—æ®µï¼ˆåŒ…æ‹¬å…¶ä»–çœä»½ï¼‰</p>
                        <div class="code-block">
{
  "fields": [
    { "field_name": "custom_1757226925033", "province": "å¹¿ä¸œçœ" },
    { "field_name": "special_requirement", "province": "å¹¿ä¸œçœ" },
    { "field_name": "sichuan_policy", "province": "å››å·çœ" }
  ]
}
                        </div>
                    </div>
                    
                    <div class="after">
                        <h4><span class="status-indicator status-success"></span>ä¿®å¤å</h4>
                        <div class="api-call">GET /api/v1/custom-fields/manage/basic?province=å››å·çœ</div>
                        <p><strong>è¿”å›ç»“æœ:</strong> åªæœ‰å››å·çœçš„å­—æ®µ</p>
                        <div class="code-block">
{
  "fields": [
    { "field_name": "sichuan_policy", "province": "å››å·çœ" },
    { "field_name": "local_requirement", "province": "å››å·çœ" }
  ]
}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¿®å¤çš„ç»„ä»¶ -->
        <div class="test-section">
            <h2 class="test-title">ğŸ“ ä¿®å¤çš„æ–‡ä»¶</h2>
            
            <div class="test-case">
                <h3>APIå±‚ä¿®å¤</h3>
                <ul>
                    <li><strong>src/api/policies.ts</strong>: 
                        <span class="highlight">getCustomFieldValues</span> å‡½æ•°å¢åŠ çœä»½å‚æ•°</li>
                </ul>
                
                <h3>ç»„ä»¶å±‚ä¿®å¤</h3>
                <ul>
                    <li><strong>UnitPolicyDisplay.vue</strong>: æ›´æ–°APIè°ƒç”¨ï¼Œä¼ é€’çœä»½å‚æ•°</li>
                    <li><strong>PolicyDisplayView.vue</strong>: æ·»åŠ çœä»½æå–é€»è¾‘ï¼Œæ›´æ–°APIè°ƒç”¨</li>
                    <li><strong>EarlyBatchInfo.vue</strong>: ä¿®å¤æ­£åˆ™è¡¨è¾¾å¼</li>
                    <li><strong>RuralGridInfo.vue</strong>: ä¿®å¤æ­£åˆ™è¡¨è¾¾å¼</li>
                    <li><strong>FieldManagerDialog.vue</strong>: æ·»åŠ è°ƒè¯•ä¿¡æ¯</li>
                </ul>
            </div>
        </div>

        <!-- éªŒè¯æ£€æŸ¥æ¸…å• -->
        <div class="test-section">
            <h2 class="test-title">âœ… éªŒè¯æ£€æŸ¥æ¸…å•</h2>
            
            <div class="test-case">
                <div id="checklist">
                    <div class="check-item">
                        <span class="status-indicator status-success"></span>
                        <strong>APIå‚æ•°ä¼ é€’:</strong> getCustomFieldValuesç°åœ¨æ”¯æŒprovinceå‚æ•°
                    </div>
                    <div class="check-item">
                        <span class="status-indicator status-success"></span>
                        <strong>æ­£åˆ™è¡¨è¾¾å¼ä¿®å¤:</strong> æ­£ç¡®è¯†åˆ«ä¸­æ–‡çœä»½åç§°
                    </div>
                    <div class="check-item">
                        <span class="status-indicator status-success"></span>
                        <strong>ç»„ä»¶è°ƒç”¨æ›´æ–°:</strong> æ‰€æœ‰ç›¸å…³ç»„ä»¶éƒ½ä¼ é€’çœä»½å‚æ•°
                    </div>
                    <div class="check-item">
                        <span class="status-indicator status-success"></span>
                        <strong>æ„å»ºæµ‹è¯•:</strong> é¡¹ç›®æ„å»ºæˆåŠŸï¼Œæ— è¯­æ³•é”™è¯¯
                    </div>
                    <div class="check-item">
                        <span class="status-indicator status-success"></span>
                        <strong>è°ƒè¯•ä¿¡æ¯:</strong> æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
                    </div>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•è¯´æ˜ -->
        <div class="test-section">
            <h2 class="test-title">ğŸ§ª æµ‹è¯•è¯´æ˜</h2>
            
            <div class="test-case">
                <h3>å¦‚ä½•éªŒè¯ä¿®å¤æ•ˆæœ:</h3>
                <ol>
                    <li>é€‰æ‹©ä¸€ä¸ªå››å·çœçš„ç”µåŠ›å…¬å¸å•ä½</li>
                    <li>æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤provinceå‚æ•°æ­£ç¡®æå–</li>
                    <li>è§‚å¯Ÿå­—æ®µåŠ è½½APIè°ƒç”¨æ˜¯å¦åŒ…å«provinceå‚æ•°</li>
                    <li>ç‚¹å‡»"ç®¡ç†å­—æ®µ"æŒ‰é’®ï¼Œç¡®è®¤å­—æ®µç®¡ç†APIè°ƒç”¨åŒ…å«provinceå‚æ•°</li>
                    <li>éªŒè¯åªæ˜¾ç¤ºå››å·çœç›¸å…³çš„å­—æ®µï¼Œä¸æ˜¾ç¤ºå…¶ä»–çœä»½å­—æ®µ</li>
                </ol>
                
                <h3>é¢„æœŸè¡Œä¸º:</h3>
                <ul>
                    <li>å­—æ®µå€¼API: <code>/api/v1/custom-fields/values/5?section=basic&province=å››å·çœ</code></li>
                    <li>å­—æ®µç®¡ç†API: <code>/api/v1/custom-fields/manage/basic?province=å››å·çœ</code></li>
                    <li>åªæ˜¾ç¤ºå››å·çœç›¸å…³çš„è‡ªå®šä¹‰å­—æ®µ</li>
                    <li>æ§åˆ¶å°æ˜¾ç¤ºæ­£ç¡®çš„è°ƒè¯•ä¿¡æ¯</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæµ‹è¯•åœºæ™¯
        const testScenarios = [
            {
                unitName: 'å››å·çœç”µåŠ›å…¬å¸',
                expectedProvince: 'å››å·çœ',
                section: 'basic',
                expectedAPI: '/api/v1/custom-fields/values/5?section=basic&province=%E5%9B%9B%E5%B7%9D%E7%9C%81'
            },
            {
                unitName: 'å¹¿ä¸œçœç”µåŠ›æœ‰é™å…¬å¸', 
                expectedProvince: 'å¹¿ä¸œçœ',
                section: 'basic',
                expectedAPI: '/api/v1/custom-fields/values/5?section=basic&province=%E5%B9%BF%E4%B8%9C%E7%9C%81'
            }
        ];

        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºæµ‹è¯•åœºæ™¯
        window.onload = function() {
            console.log('ğŸ§ª çœä»½ç­›é€‰ä¿®å¤éªŒè¯æµ‹è¯•');
            console.log('æµ‹è¯•åœºæ™¯:', testScenarios);
            
            testScenarios.forEach((scenario, index) => {
                console.log(`åœºæ™¯ ${index + 1}:`, {
                    'å•ä½åç§°': scenario.unitName,
                    'é¢„æœŸçœä»½': scenario.expectedProvince,
                    'é¢„æœŸAPI': scenario.expectedAPI
                });
            });
            
            console.log('âœ… ä¿®å¤å·²å®Œæˆï¼Œç°åœ¨å¯ä»¥åœ¨å®é™…ç¯å¢ƒä¸­æµ‹è¯•');
        };
    </script>
</body>
</html>