<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ··åˆå­—æ®µç¼–è¾‘é—®é¢˜ä¿®å¤æ–¹æ¡ˆ</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
      line-height: 1.6;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #52c41a;
      border-bottom: 2px solid #52c41a;
      padding-bottom: 10px;
      margin-bottom: 30px;
    }
    h2 {
      color: #333;
      margin-top: 30px;
      margin-bottom: 15px;
      border-left: 4px solid #1890ff;
      padding-left: 10px;
    }
    .problem-analysis {
      background: #fff2e8;
      border: 1px solid #ffbb96;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .solution {
      background: #f6ffed;
      border: 1px solid #95de64;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .api-flow {
      background: #e6f7ff;
      border: 1px solid #91d5ff;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .code-block {
      background: #f6f8fa;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      padding: 15px;
      margin: 10px 0;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 14px;
      overflow-x: auto;
    }
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    .comparison-table th,
    .comparison-table td {
      border: 1px solid #d9d9d9;
      padding: 12px;
      text-align: left;
    }
    .comparison-table th {
      background: #fafafa;
      font-weight: 600;
    }
    .before {
      background: #fff1f0;
      color: #cf1322;
    }
    .after {
      background: #f6ffed;
      color: #52c41a;
    }
    .step {
      display: flex;
      align-items: flex-start;
      margin: 15px 0;
    }
    .step-number {
      background: #1890ff;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      margin-right: 15px;
      font-weight: bold;
      flex-shrink: 0;
    }
    .step-content {
      flex: 1;
    }
    .warning {
      background: #fff2e8;
      border: 1px solid #ffbb96;
      border-radius: 6px;
      padding: 15px;
      margin: 15px 0;
      color: #d4380d;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¯ æ··åˆå­—æ®µç¼–è¾‘é—®é¢˜ä¿®å¤æ–¹æ¡ˆ</h1>
    
    <div class="problem-analysis">
      <h3>ğŸš¨ é—®é¢˜å‘ç°</h3>
      <p><strong>ç”¨æˆ·åé¦ˆï¼š</strong>"å¦‚æœæˆ‘åŒæ—¶ä¿®æ”¹åŸæœ¬çš„å­—æ®µå’Œé™„åŠ å­—æ®µï¼Œé‚£ä¸å°±æ˜¾ç¤ºä¸å…¨äº†å—ï¼Ÿ"</p>
      <p><strong>é—®é¢˜åˆ†æï¼š</strong>ç”¨æˆ·å®Œå…¨æ­£ç¡®ï¼ä¹‹å‰çš„ä¿®å¤æ–¹æ¡ˆåªåœ¨ä¿å­˜ååˆ·æ–°è‡ªå®šä¹‰å­—æ®µï¼Œä¼šå¯¼è‡´åŸºæœ¬å­—æ®µçš„ä¿®æ”¹ä¸æ˜¾ç¤ºã€‚</p>
    </div>

    <h2>ğŸ“Š API è°ƒç”¨æµç¨‹åˆ†æ</h2>
    
    <div class="api-flow">
      <h4>å½“ç”¨æˆ·åŒæ—¶ä¿®æ”¹åŸºæœ¬å­—æ®µå’Œè‡ªå®šä¹‰å­—æ®µæ—¶ï¼š</h4>
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <strong>ä¿å­˜åŸºæœ¬å­—æ®µï¼š</strong> PUT <code>/api/v1/policy-sections/5/early-batch</code><br>
          æºå¸¦åŸºæœ¬å­—æ®µæ•°æ®
        </div>
      </div>
      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <strong>ä¿å­˜è‡ªå®šä¹‰å­—æ®µï¼š</strong> PUT <code>/api/v1/custom-fields/values/5</code><br>
          æºå¸¦ <code>{"section":"early_batch","field_values":{"custom_xxx":"111111"}}</code>
        </div>
      </div>
      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <strong>è·å–è‡ªå®šä¹‰å­—æ®µï¼š</strong> GET <code>/api/v1/custom-fields/values/5?section=early_batch</code><br>
          è¿”å›æ­£ç¡®çš„è‡ªå®šä¹‰å­—æ®µå€¼
        </div>
      </div>
      <div class="step">
        <div class="step-number">4</div>
        <div class="step-content">
          <strong>è·å–åŸºæœ¬å­—æ®µï¼š</strong> GET <code>/api/v1/policy-sections/5/early-batch</code><br>
          è¿”å›åŸºæœ¬å­—æ®µæ•°æ®ï¼Œ<span style="color: #cf1322;">ä½†è¦†ç›–äº†è‡ªå®šä¹‰å­—æ®µï¼</span>
        </div>
      </div>
    </div>

    <h2>ğŸ” æ ¹æœ¬åŸå› åˆ†æ</h2>

    <div class="code-block">
<strong>é—®é¢˜å‡ºåœ¨æ•°æ®åˆå¹¶çš„ä¼˜å…ˆçº§ï¼š</strong>

// âŒ é”™è¯¯çš„åˆå¹¶é¡ºåº
earlyBatchInfo.value = { ...earlyBatchInfo.value, ...convertedData }
//                        ^è‡ªå®šä¹‰å­—æ®µåœ¨å‰      ^åŸºæœ¬å­—æ®µåœ¨åï¼Œä¼šè¦†ç›–è‡ªå®šä¹‰å­—æ®µ

// ç»“æœï¼šåŸºæœ¬å­—æ®µè¦†ç›–è‡ªå®šä¹‰å­—æ®µ â†’ è‡ªå®šä¹‰å­—æ®µå€¼ä¸¢å¤±
    </div>

    <h2>ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ</h2>

    <div class="solution">
      <h4>âœ… æ­£ç¡®çš„è§£å†³æ€è·¯ï¼š</h4>
      <ol>
        <li><strong>ä¿æŒå®Œæ•´çš„æ•°æ®åˆ·æ–°ï¼š</strong>åŒæ—¶ä¿®æ”¹æ—¶ä»éœ€è¦é‡æ–°åŠ è½½æ‰€æœ‰æ•°æ®</li>
        <li><strong>ä¿®å¤åˆå¹¶ä¼˜å…ˆçº§ï¼š</strong>ç¡®ä¿è‡ªå®šä¹‰å­—æ®µä¸è¢«åŸºæœ¬å­—æ®µè¦†ç›–</li>
        <li><strong>ä¼˜åŒ–æ•°æ®æ ¼å¼ï¼š</strong>ç»Ÿä¸€å­—æ®µå€¼çš„æ•°æ®ç»“æ„</li>
      </ol>
    </div>

    <h3>å…·ä½“ä¿®å¤å†…å®¹</h3>

    <table class="comparison-table">
      <thead>
        <tr>
          <th>ä¿®å¤é¡¹</th>
          <th>ä¿®å¤å‰</th>
          <th>ä¿®å¤å</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>æ•°æ®åˆ·æ–°ç­–ç•¥</strong></td>
          <td class="before">åªåˆ·æ–°è‡ªå®šä¹‰å­—æ®µ<br>â†’ åŸºæœ¬å­—æ®µä¿®æ”¹ä¸¢å¤±</td>
          <td class="after">é‡æ–°åŠ è½½æ‰€æœ‰æ•°æ®<br>â†’ åŸºæœ¬å­—æ®µå’Œè‡ªå®šä¹‰å­—æ®µéƒ½æ›´æ–°</td>
        </tr>
        <tr>
          <td><strong>åˆå¹¶ä¼˜å…ˆçº§</strong></td>
          <td class="before">{...existing, ...basicFields}<br>â†’ åŸºæœ¬å­—æ®µè¦†ç›–è‡ªå®šä¹‰å­—æ®µ</td>
          <td class="after">{...basicFields, ...customFields}<br>â†’ è‡ªå®šä¹‰å­—æ®µä¼˜å…ˆçº§æ›´é«˜</td>
        </tr>
        <tr>
          <td><strong>å­—æ®µå€¼æ ¼å¼</strong></td>
          <td class="before">field_value ç›´æ¥èµ‹å€¼<br>â†’ æ ¼å¼ä¸ç»Ÿä¸€</td>
          <td class="after">{value, display_name, type}<br>â†’ æ ¼å¼ç»Ÿä¸€</td>
        </tr>
      </tbody>
    </table>

    <h2>ğŸ“ ä»£ç ä¿®å¤è¯¦æƒ…</h2>

    <h3>1. æ¢å¤å®Œæ•´æ•°æ®åˆ·æ–°</h3>
    <div class="code-block">
// æå‰æ‰¹æ¿å—å’Œå†œç½‘æ¿å— onSave å‡½æ•°ä¸­ï¼š

// ä¿å­˜æˆåŠŸåé‡æ–°è·å–æœ€æ–°æ•°æ®ï¼ˆåŒ…æ‹¬åŸºæœ¬å­—æ®µå’Œè‡ªå®šä¹‰å­—æ®µï¼‰
await loadEarlyBatchData(props.unitId)  // æˆ– loadRuralGridData(props.unitId)
console.log('âœ… ç»Ÿä¸€ä¿å­˜å®Œæˆï¼Œå·²åˆ·æ–°æœ€æ–°æ•°æ®')
    </div>

    <h3>2. ä¿®å¤åˆå¹¶ä¼˜å…ˆçº§</h3>
    <div class="code-block">
// ä¿®å¤å‰ï¼šåŸºæœ¬å­—æ®µè¦†ç›–è‡ªå®šä¹‰å­—æ®µ âŒ
earlyBatchInfo.value = { ...earlyBatchInfo.value, ...convertedData }

// ä¿®å¤åï¼šè‡ªå®šä¹‰å­—æ®µä¼˜å…ˆçº§æ›´é«˜ âœ…
const existingCustomFields = { ...earlyBatchInfo.value }
earlyBatchInfo.value = { ...convertedData, ...existingCustomFields }
    </div>

    <h3>3. ç»Ÿä¸€å­—æ®µå€¼æ ¼å¼</h3>
    <div class="code-block">
// è‡ªå®šä¹‰å­—æ®µå€¼è®¾ç½®ï¼ˆloadCustomFields å‡½æ•°ä¸­ï¼‰ï¼š
earlyBatchInfo.value[field.field_name] = {
  value: field.field_value,        // å­—æ®µå€¼
  display_name: field.display_name, // æ˜¾ç¤ºåç§°
  type: field.field_type || 'text'  // å­—æ®µç±»å‹
}
    </div>

    <h2>ğŸ§ª æµ‹è¯•åœºæ™¯</h2>

    <div class="api-flow">
      <h4>åœºæ™¯1ï¼šåªä¿®æ”¹åŸºæœ¬å­—æ®µ</h4>
      <div class="step">
        <div class="step-number">âœ…</div>
        <div class="step-content">
          ä¿å­˜ â†’ é‡æ–°åŠ è½½ â†’ åŸºæœ¬å­—æ®µæ›´æ–°ï¼Œè‡ªå®šä¹‰å­—æ®µä¿æŒä¸å˜
        </div>
      </div>

      <h4>åœºæ™¯2ï¼šåªä¿®æ”¹è‡ªå®šä¹‰å­—æ®µ</h4>
      <div class="step">
        <div class="step-number">âœ…</div>
        <div class="step-content">
          ä¿å­˜ â†’ é‡æ–°åŠ è½½ â†’ è‡ªå®šä¹‰å­—æ®µæ›´æ–°ï¼ŒåŸºæœ¬å­—æ®µä¿æŒä¸å˜
        </div>
      </div>

      <h4>åœºæ™¯3ï¼šåŒæ—¶ä¿®æ”¹åŸºæœ¬å­—æ®µå’Œè‡ªå®šä¹‰å­—æ®µ</h4>
      <div class="step">
        <div class="step-number">âœ…</div>
        <div class="step-content">
          ä¿å­˜ â†’ é‡æ–°åŠ è½½ â†’ ä¸¤ç§å­—æ®µéƒ½æ›´æ–°æ˜¾ç¤º
        </div>
      </div>
    </div>

    <h2>ğŸ¯ ä¿®å¤æ•ˆæœ</h2>

    <div class="solution">
      <h4>ç°åœ¨ç”¨æˆ·å¯ä»¥ï¼š</h4>
      <ul>
        <li>âœ… <strong>å•ç‹¬ä¿®æ”¹åŸºæœ¬å­—æ®µï¼š</strong>ä¿å­˜åæ­£ç¡®æ˜¾ç¤º</li>
        <li>âœ… <strong>å•ç‹¬ä¿®æ”¹è‡ªå®šä¹‰å­—æ®µï¼š</strong>ä¿å­˜åæ­£ç¡®æ˜¾ç¤º</li>
        <li>âœ… <strong>åŒæ—¶ä¿®æ”¹ä¸¤ç§å­—æ®µï¼š</strong>ä¿å­˜åä¸¤ç§å­—æ®µéƒ½æ­£ç¡®æ˜¾ç¤º</li>
        <li>âœ… <strong>æ•°æ®ä¸€è‡´æ€§ï¼š</strong>é¡µé¢æ˜¾ç¤ºä¸æ•°æ®åº“ä¿å­˜ä¸€è‡´</li>
        <li>âœ… <strong>çœä»½éš”ç¦»ï¼š</strong>ä¸åŒçœä»½çš„å­—æ®µç‹¬ç«‹ç®¡ç†</li>
      </ul>
    </div>

    <div class="warning">
      <h4>âš ï¸ å…³é”®æŠ€æœ¯è¦ç‚¹ï¼š</h4>
      <ul>
        <li><strong>åˆå¹¶é¡ºåºå¾ˆé‡è¦ï¼š</strong><code>{...base, ...override}</code> ä¸­åè€…ä¼˜å…ˆçº§æ›´é«˜</li>
        <li><strong>æ•°æ®æ ¼å¼ç»Ÿä¸€ï¼š</strong>ç¡®ä¿è‡ªå®šä¹‰å­—æ®µå’ŒåŸºæœ¬å­—æ®µä½¿ç”¨ç›¸åŒçš„å€¼ç»“æ„</li>
        <li><strong>æ—¶åºæ§åˆ¶ï¼š</strong>ä¿å­˜å®Œæˆåå†åˆ·æ–°æ•°æ®ï¼Œé¿å…ç«æ€æ¡ä»¶</li>
        <li><strong>ç”¨æˆ·ä½“éªŒï¼š</strong>ä¿æŒç¼–è¾‘çŠ¶æ€ï¼Œé¿å…ç”¨æˆ·è¾“å…¥ä¸¢å¤±</li>
      </ul>
    </div>

    <h2>ğŸš€ æ€»ç»“</h2>

    <p>é€šè¿‡è¿™æ¬¡ä¿®å¤ï¼Œæˆ‘ä»¬è§£å†³äº†ä¸€ä¸ªé‡è¦çš„ç”¨æˆ·åœºæ™¯é—®é¢˜ï¼š<strong>æ··åˆå­—æ®µç¼–è¾‘</strong>ã€‚ç°åœ¨æ— è®ºç”¨æˆ·å¦‚ä½•ä¿®æ”¹å­—æ®µï¼ˆåŸºæœ¬å­—æ®µã€è‡ªå®šä¹‰å­—æ®µã€æˆ–ä¸¤è€…æ··åˆï¼‰ï¼Œä¿å­˜åéƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰çš„ä¿®æ”¹ç»“æœã€‚</p>

    <p>è¿™ä¸ªä¿®å¤ä¸ä»…è§£å†³äº†æŠ€æœ¯é—®é¢˜ï¼Œæ›´é‡è¦çš„æ˜¯æå‡äº†ç”¨æˆ·ä½“éªŒï¼Œè®©å­—æ®µç®¡ç†åŠŸèƒ½æ›´åŠ å¯é å’Œç›´è§‚ã€‚</p>

    <p style="text-align: center; margin-top: 40px; color: #666; font-size: 14px;">
      ğŸ“ ç”Ÿæˆæ—¶é—´: <script>document.write(new Date().toLocaleString('zh-CN'))</script>
    </p>
  </div>
</body>
</html>