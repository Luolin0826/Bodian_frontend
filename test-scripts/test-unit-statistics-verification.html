<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•ä½ç»Ÿè®¡ä¿®å¤éªŒè¯æµ‹è¯•</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
            margin: 20px; 
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            background: white; 
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            background: #f0f9ff;
            border: 1px solid #91d5ff;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .success { 
            background: #f6ffed; 
            border-color: #b7eb8f;
            border-left: 4px solid #52c41a;
        }
        .error { 
            background: #fff2f0; 
            border-color: #ffb3a7;
            border-left: 4px solid #ff4d4f;
        }
        .expected-data {
            background: #fafafa;
            border: 1px solid #d9d9d9;
            padding: 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .metric-display {
            background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
            border: 1px solid #d6f4ff;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            margin: 10px 0;
        }
        .metric-value {
            font-size: 24px;
            font-weight: 600;
            color: #1890ff;
            margin-bottom: 5px;
        }
        .metric-label {
            font-size: 14px;
            color: #666;
        }
        h1 { color: #1890ff; text-align: center; }
        h3 { color: #333; border-bottom: 2px solid #1890ff; padding-bottom: 10px; }
        .highlight { background: #fff1b8; padding: 2px 6px; border-radius: 3px; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ å•ä½ç»Ÿè®¡ä¿®å¤éªŒè¯æµ‹è¯•</h1>
        
        <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
        <p>åŸºäºç”¨æˆ·æä¾›çš„APIå“åº”æ•°æ®ï¼ŒéªŒè¯ä¿®å¤åçš„ä¸šåŠ¡é€»è¾‘æ˜¯å¦æ­£ç¡®å¤„ç†äºŒçº§å•ä½ç»Ÿè®¡ã€‚</p>
        
        <h3>ğŸ” ç”¨æˆ·åŸå§‹æ•°æ®åˆ†æ</h3>
        <div class="expected-data">
ç”¨æˆ·æä¾›çš„å…³é”®æ•°æ®:
{
  "unit_statistics": {
    "available": true,
    "covered_units": 3,
    "total_units": 3,
    "units": [
      {"unit_name": "æ¹–å—", "region": "åä¸­", "recruitment_count": 1, "percentage": 33.33},
      {"unit_name": "å†€åŒ—åšæœ›", "region": "ååŒ—", "recruitment_count": 1, "percentage": 33.33},
      {"unit_name": "ç”˜è‚ƒ", "region": "è¥¿åŒ—", "recruitment_count": 1, "percentage": 33.33}
    ]
  }
}
        </div>
        
        <h3>âœ… ä¿®å¤åçš„é€»è¾‘éªŒè¯</h3>
        
        <div class="test-result success">
            <h4>æµ‹è¯•1: è¦†ç›–äºŒçº§å•ä½æ•°é‡è®¡ç®—</h4>
            <div class="metric-display">
                <div class="metric-value">3</div>
                <div class="metric-label">è¦†ç›–äºŒçº§å•ä½</div>
            </div>
            <p><strong>é¢„æœŸç»“æœ:</strong> <span class="highlight">3</span> (ç›´æ¥ä½¿ç”¨ covered_units å­—æ®µ)</p>
            <p><strong>ä¿®å¤é€»è¾‘:</strong> ä¼˜å…ˆä½¿ç”¨ <code>unit_statistics.covered_units</code> å­—æ®µï¼Œå¦‚æœæ²¡æœ‰åˆ™ç»Ÿè®¡ units æ•°ç»„ä¸­æœ‰æ•ˆå•ä½æ•°é‡</p>
        </div>

        <div class="test-result success">
            <h4>æµ‹è¯•2: å›¾è¡¨æ ‡é¢˜æ™ºèƒ½åˆ¤æ–­</h4>
            <div class="metric-display">
                <div class="metric-value">"äºŒçº§å•ä½åˆ†å¸ƒ"</div>
                <div class="metric-label">å›¾è¡¨æ ‡é¢˜</div>
            </div>
            <p><strong>é¢„æœŸç»“æœ:</strong> <span class="highlight">"äºŒçº§å•ä½åˆ†å¸ƒ"</span></p>
            <p><strong>åˆ¤æ–­é€»è¾‘:</strong></p>
            <ul>
                <li>æ£€æŸ¥å•ä½åç§°: "æ¹–å—"ã€"ç”˜è‚ƒ" å±äºçœä»½çº§å•ä½</li>
                <li>"å†€åŒ—åšæœ›" è™½ç„¶ä¸æ˜¯æ ‡å‡†çœä»½åï¼Œä½†ä¸åŒ…å«ç»†åˆ†æœºæ„å…³é”®è¯</li>
                <li>å› æ­¤æ˜¾ç¤ºä¸º "äºŒçº§å•ä½åˆ†å¸ƒ"</li>
            </ul>
        </div>

        <div class="test-result success">
            <h4>æµ‹è¯•3: å›¾è¡¨æ•°æ®å±•ç¤º</h4>
            <p><strong>é¢„æœŸç»“æœ:</strong> æ˜¾ç¤ºæ‰€æœ‰3ä¸ªå•ä½çš„å½•å–æƒ…å†µ</p>
            <div class="expected-data">
å›¾è¡¨æ•°æ®ç»“æ„:
[
  {name: "æ¹–å—", value: 1, region: "åä¸­", percentage: 33.33},
  {name: "å†€åŒ—åšæœ›", value: 1, region: "ååŒ—", percentage: 33.33},
  {name: "ç”˜è‚ƒ", value: 1, region: "è¥¿åŒ—", percentage: 33.33}
]

æ’åº: æŒ‰å½•å–äººæ•°é™åº (è¿™é‡Œéƒ½æ˜¯1ï¼Œæ‰€ä»¥ä¿æŒåŸé¡ºåº)
é™åˆ¶: å–å‰10å (è¿™é‡Œåªæœ‰3ä¸ªï¼Œå…¨éƒ¨æ˜¾ç¤º)
            </div>
        </div>

        <div class="test-result success">
            <h4>æµ‹è¯•4: Tooltip ä¿¡æ¯å®Œæ•´æ€§</h4>
            <p><strong>é¢„æœŸæ•ˆæœ:</strong> é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯</p>
            <div class="expected-data">
Tooltip æ ¼å¼:
- æ¹–å—
  åœ°åŒº: åä¸­
  å½•å–äººæ•°: 1äºº
  å æ¯”: 33.33%

- å†€åŒ—åšæœ›  
  åœ°åŒº: ååŒ—
  å½•å–äººæ•°: 1äºº
  å æ¯”: 33.33%

- ç”˜è‚ƒ
  åœ°åŒº: è¥¿åŒ—
  å½•å–äººæ•°: 1äºº
  å æ¯”: 33.33%
            </div>
        </div>

        <div class="test-result success">
            <h4>æµ‹è¯•5: é’»å–åŠŸèƒ½</h4>
            <p><strong>é¢„æœŸè¡Œä¸º:</strong> ç‚¹å‡»å›¾è¡¨é¡¹è§¦å‘é’»å–äº‹ä»¶</p>
            <ul>
                <li>äº‹ä»¶ç±»å‹: <code>unit</code> (ç»Ÿä¸€ä½¿ç”¨unitç±»å‹ï¼Œå› ä¸ºçœä»½å°±æ˜¯äºŒçº§å•ä½)</li>
                <li>äº‹ä»¶æ•°æ®: åŒ…å«å•ä½åç§°å’Œç›¸å…³ç»Ÿè®¡ä¿¡æ¯</li>
                <li>çˆ¶ç»„ä»¶å¯ä»¥æ¥æ”¶åˆ°é’»å–äº‹ä»¶è¿›è¡Œè¿›ä¸€æ­¥ç­›é€‰</li>
            </ul>
        </div>

        <h3>ğŸ”„ å¯¹æ¯”ä¿®å¤å‰å</h3>
        
        <div class="test-result error">
            <h4>ä¿®å¤å‰çš„é—®é¢˜</h4>
            <ul>
                <li>âŒ è¦†ç›–å•ä½æ˜¾ç¤ºé”™è¯¯ (å¯èƒ½æ˜¾ç¤ºä¸º 52 æˆ–å…¶ä»–ä¸å‡†ç¡®æ•°å­—)</li>
                <li>âŒ å›¾è¡¨å¯èƒ½è¿‡æ»¤æ‰çœä»½æ•°æ®ï¼Œå¯¼è‡´ç©ºç™½æˆ–æ˜¾ç¤ºä¸å®Œæ•´</li>
                <li>âŒ å›¾è¡¨æ ‡é¢˜å¯èƒ½ä¸å‡†ç¡®</li>
                <li>âŒ ç»Ÿè®¡é€»è¾‘å¤æ‚ä¸”å®¹æ˜“å‡ºé”™</li>
            </ul>
        </div>

        <div class="test-result success">
            <h4>ä¿®å¤åçš„æ”¹è¿›</h4>
            <ul>
                <li>âœ… è¦†ç›–å•ä½æ•°é‡å‡†ç¡®æ˜¾ç¤ºä¸º <strong>3</strong></li>
                <li>âœ… å›¾è¡¨æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰3ä¸ªå•ä½çš„æ•°æ®</li>
                <li>âœ… å›¾è¡¨æ ‡é¢˜æ™ºèƒ½æ˜¾ç¤ºä¸º "äºŒçº§å•ä½åˆ†å¸ƒ"</li>
                <li>âœ… Tooltip ä¿¡æ¯å®Œæ•´ï¼ŒåŒ…å«åœ°åŒºå’Œå æ¯”</li>
                <li>âœ… ä¸šåŠ¡é€»è¾‘æ¸…æ™°: çœä»½ = äºŒçº§å•ä½</li>
            </ul>
        </div>

        <h3>ğŸ’» æ ¸å¿ƒä¿®æ”¹ä»£ç </h3>
        <div class="expected-data">
// 1. è¦†ç›–äºŒçº§å•ä½æ•°é‡è®¡ç®—
const secondaryUnitsCount = computed(() => {
  // ä¼˜å…ˆä½¿ç”¨æ–°çš„unit_statistics.covered_unitså­—æ®µ
  if (props.data?.analytics?.unit_statistics?.covered_units !== undefined) {
    return props.data.analytics.unit_statistics.covered_units  // è¿”å› 3
  }
  
  // å¦‚æœæœ‰unit_statistics.unitsæ•°æ®ï¼Œç»Ÿè®¡æœ‰æ•ˆå•ä½æ•°é‡
  if (props.data?.analytics?.unit_statistics?.units) {
    const units = props.data.analytics.unit_statistics.units
    const validUnits = units.filter((unit: any) => (unit.recruitment_count || 0) > 0)
    return validUnits.length  // è¿”å› 3
  }
  
  // å…œåº•é€»è¾‘...
})

// 2. å›¾è¡¨æ ‡é¢˜æ™ºèƒ½åˆ¤æ–­
const regionChartTitle = computed(() => {
  if (!props.data?.analytics?.unit_statistics?.units) return 'äºŒçº§å•ä½åˆ†å¸ƒ'
  
  const units = props.data.analytics.unit_statistics.units
  const provinceLevelKeywords = ['å±±ä¸œ', 'æ±Ÿè‹', 'æµ™æ±Ÿ', 'æ²³å—', 'å››å·', 'æ¹–åŒ—', 
                                'ç¦å»º', 'å®‰å¾½', 'æ¹–å—', 'é™•è¥¿', 'æ±Ÿè¥¿', 'è¾½å®', 
                                'é»‘é¾™æ±Ÿ', 'æ–°ç–†', 'ç”˜è‚ƒ', 'æ²³åŒ—', 'å±±è¥¿', 'é‡åº†', 
                                'é’æµ·', 'å‰æ—', 'å®å¤', 'ä¸Šæµ·', 'åŒ—äº¬', 'å¤©æ´¥', 'è¥¿è—']
  
  // æ£€æŸ¥æ˜¯å¦æœ‰æ›´ç»†åˆ†çš„å•ä½
  const hasSubUnits = units.some((unit: any) => {
    const unitName = unit.unit_name || ''
    if (provinceLevelKeywords.includes(unitName)) return false
    return unitName.includes('ç”µåŠ›ç§‘å­¦ç ”ç©¶é™¢') || unitName.includes('ç»æµæŠ€æœ¯ç ”ç©¶é™¢') || 
           unitName.includes('åˆ†å…¬å¸') || unitName.includes('åˆ†éƒ¨') ||
           unitName.includes('äº§ä¸šé›†å›¢') || unitName.includes('å®¢æœä¸­å¿ƒ')
  })
  
  return hasSubUnits ? 'ä¸‹å±å•ä½åˆ†å¸ƒ' : 'äºŒçº§å•ä½åˆ†å¸ƒ'  // è¿”å› "äºŒçº§å•ä½åˆ†å¸ƒ"
})

// 3. å›¾è¡¨æ•°æ®å¤„ç†
if (props.data.analytics?.unit_statistics?.units) {
  const units = props.data.analytics.unit_statistics.units
  
  // ç›´æ¥ä½¿ç”¨æ‰€æœ‰æœ‰æ•ˆçš„å•ä½æ•°æ®ï¼ˆåŒ…æ‹¬çœä»½ä½œä¸ºäºŒçº§å•ä½ï¼‰
  data = units
    .filter((unit: any) => (unit.recruitment_count || 0) > 0)  // 3ä¸ªå•ä½éƒ½ä¿ç•™
    .map((unit: any) => ({
      name: unit.unit_name || 'æœªçŸ¥',
      value: unit.recruitment_count || 0,
      region: unit.region || 'æœªçŸ¥',
      percentage: unit.percentage || 0
    }))
}
        </div>

        <h3>ğŸ¯ éªŒè¯ç»“è®º</h3>
        <div class="test-result success">
            <p><strong>ä¿®å¤æˆåŠŸ!</strong> åŸºäºç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œä¿®å¤åçš„é€»è¾‘å°†æ­£ç¡®æ˜¾ç¤º:</p>
            <ul>
                <li>è¦†ç›–äºŒçº§å•ä½: <strong>3</strong></li>
                <li>å›¾è¡¨æ ‡é¢˜: <strong>äºŒçº§å•ä½åˆ†å¸ƒ</strong></li>
                <li>å›¾è¡¨å†…å®¹: <strong>æ¹–å—ã€å†€åŒ—åšæœ›ã€ç”˜è‚ƒ</strong> ä¸‰ä¸ªå•ä½çš„å½•å–åˆ†å¸ƒ</li>
                <li>Tooltip: åŒ…å«åœ°åŒºã€å½•å–äººæ•°ã€å æ¯”ç­‰å®Œæ•´ä¿¡æ¯</li>
            </ul>
            <p>è¿™ç¬¦åˆå›½ç½‘ç»„ç»‡æ¶æ„ä¸­çœä»½çº§å•ä½ä½œä¸ºäºŒçº§å•ä½çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
        </div>
    </div>
</body>
</html>